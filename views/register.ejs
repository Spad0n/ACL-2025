<!DOCTYPE html>
<html lang="fr">
<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/stylesheet1.css">
    <script src="js/switch.js"></script>

</head>
<body>
<script>

    // on attend que le DOM soit completement load, et ensuite on place l'ecouteur.
    document.addEventListener("DOMContentLoaded", function() {
        const accountForm = document.forms.accountCreation ;
        console.log(accountForm); // This should log the form object
        accountForm.addEventListener("submit", (e) => {
            e.preventDefault();
            validateAccountCreation();
        });
    });

    async function validateAccountCreation() {

        const accountForm       = document.forms.accountCreation ;
        const passwordMessage   = document.getElementById("passwordMessage");
        const passwordRepeated  = document.getElementById("passwordRepeated");

        const passwordRepeatedMessage = document.getElementById("passwordRepeatedMessage");

        passwordMessage.textContent             = "";
        passwordRepeatedMessage.textContent     = "";


        if (accountForm.password.value.length < 8) {

            passwordMessage.textContent = "Le mot de passe doit contenir au moins 8 caractères.";
        }

        else if (accountForm.password.value != passwordRepeated.value) {

            passwordRepeatedMessage.textContent = "Les mots de passe ne correspondent pas.";
        }

        else {

            const rawValue = accountForm.password.value;
            //accountForm.password.value = await hashSHA256(rawValue);
            accountForm.submit();
            accountForm.password.value = rawValue;
        }
    }

</script>

<div id="conteneur1" class="actif">
     <button id="pageSwitch">ENG</button>
    <h1 id="pageTitre">Bienvenue chez le<br>CROQUEMITAINE</h1>
    <form name="accountCreation" action="/account/new" method="POST">
        <label id="pageUsername" for="username">Entrez le nom d'utilisateur</label>
        <input id="username" name="username" value="<%= locals.username ?? '' %>" />
        <label style="color: red"><%= locals.message ?? '' %></label>
        <label id="password" for="password">Entrez le mot de passe</label>
        <input id="password" type="password" name="password" value="" />
        <label id="passwordMessage" style="color: red"></label>
        <label id="confirmPassword" for="passwordRepeated">Confirmez le mot de passe</label>
        <input type="password" id="passwordRepeated" value="" />
        <label id="passwordRepeatedMessage" style="color: red"></label>
        <input id="connexionBouton" type="submit" value="Créer le compte" />
    </form>
    <div id="boutons">
        <button id="inscriptionBouton" onclick="window.location.href='/login';">Se connecter</button>
    </div>
</div>

<script>
    const bouton = document.getElementById("pageSwitch");
    const username = document.getElementById("pageUsername");
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirmPassword");
    const titre = document.getElementById("pageTitre");

    bouton.addEventListener("click", () => {
        if(bouton.textContent == "ENG"){
            titre.textContent = "Welcome at Boogeyman";
            username.textContent = "Enter the username";
            password.textContent = "Enter the password";
            confirmPassword.textContent = "Confirm password"

            boutonConnexion = document.getElementById("connexionBouton").value = "Create account";
            document.getElementById("inscriptionBouton").textContent = "Login";
            bouton.textContent = "FR";
        }
    else{
            window.location.href = '/register';
    }
});

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/stylesheet1.css">
    <script src="js/switch.js"></script>

</head>
<body>
    
    <script>

        // on attend que le DOM soit completement charger, et ensuite on place l'ecouteur.
        document.addEventListener("DOMContentLoaded", function() {
            const accountForm = document.forms.accountCreation ;
            console.log(accountForm); // This should log the form object
            accountForm.addEventListener("submit", (e) => {
                e.preventDefault();
                validateAccountCreation();
            });
        });

        async function validateAccountCreation() {
            const accountForm = document.forms.accountCreation ;
            const passwordMessage = document.getElementById("passwordMessage");
            const passwordRepeated = document.getElementById("passwordMessage");
            console.log("mdp",passwordMessage.textContent);
            console.log("mdp repeat",passwordRepeated.textContent);
            const passwordRepeatedMessage = document.getElementById("passwordRepeatedMessage");
            passwordMessage.textContent = "";
            passwordRepeatedMessage.textContent = "";
            if (accountForm.password.value.length < 8) {
                passwordMessage.textContent = "Le mot de passe doit contenir au moins 8caractÃ¨res.";
            } else if (accountForm.password.value != passwordRepeated.value) {
                passwordRepeatedMessage.textContent = "Les mots de passe ne correspondent pas.";
            } else {
                const rawValue = accountForm.password.value;
                accountForm.password.value = await hashSHA256(rawValue);
                accountForm.submit();
                accountForm.password.value = rawValue;
            }
        }

    </script>

<div id="conteneur" class="actif">
    <h1>Bienvenue chez le<br>CROQUEMITAINE</h1>

    <form name="formLogIn" method="post" class="connexion" action="/login">
        <label for="utilisateur">Adresse mail</label>
        <input type="text" id="utilisateurLogin" name="utilisateur" required><br><br>

        <label for="mdp">Mot de passe</label>
        <input type="password" id="mdpLogin" name="mdp" required><br><br>
        <input id="connexionBouton" type="submit" value="Se connecter">
    </form>

    <div id="boutons">
        <p>ou</p> 
        <button id="inscriptionBouton" onclick="handleSwitch()">S'inscrire</button>
    </div>
</div>

<div id="conteneur1">
   <form name="accountCreation" action="/account/new" method="POST">
    <table>
        <tbody>
            <tr><td><label for="username">Entrez le nom d'utilisateur</label></td>
            <td><input name="username" value="<%= locals.username ?? '' %>" /></td>
            <td><label><%= locals.message ?? '' %></label></td></tr>
            <tr><td><label for="password">Entrez le mot de passe</label></td>
            <td><input type="password" name="password" value="" /></td>
            <td><label id="passwordMessage"></label></td></tr>
            <tr><td><label for="passwordRepeated">Confirmez le mot de passe</label></td>
            <td><input type="password" id="passwordRepeated" value="" /></td>
            <td><label id="passwordRepeatedMessage"></label></td></tr>
        </tbody>
    </table>
    <div><input type="submit" /></div>
   </form> 

    <div id="boutons">
        <p>ou</p>
        <button id="inscriptionBouton" onclick="handleSwitch()">Se connecter</button>
    </div>
</div>

</body>
</html>
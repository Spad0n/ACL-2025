<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/style.css">

    <style>
        /* --- Colonne agenda --- */
        #sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            height: 100vh;
            background: #2b014d;
            padding: 20px;
            color: white;
            z-index: 10;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .agenda-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #4a007a;
            padding-bottom: 10px;
        }

        .agenda-header h2 {
            margin: 0;
            padding: 0;
            flex-grow: 1;
        }

        #new-agenda {
            margin: 0;
            padding: 0px 10px;
            font-size: 25px;
            font-weight: bold;
            background: #6a00a1;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            line-height: 1;
            transition: background-color 1.0s;
        }

        #new-agenda:hover {
            background: #7d00b3;
        }

        #agenda-list {
            list-style: none;
            padding: 0;
            margin: 20px;
        }

        #agenda-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: #4a007a;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 1.0s;
        }

        #agenda-list li:hover {
            background: #5e0c9a;
        }

        .agenda-nom {
            flex-grow: 1;
            padding-right: 10px;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .agenda-supprimer {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            padding: 0 5px;
            margin: 0;
            border-radius: 3px;
            line-height: 1;
            transition: background-color 0.2s, color 0.2s;
        }

        .agenda-supprimer:hover {
            color: #ff4d4d;
            background-color: rgba(255, 255, 255, 0.1);
        }

      /* Ajuster le canvas pour laisser la place à la colonne */
      #canvasBackground {
          position: fixed;
          top: 0;
          left: 250px;
          width: calc(100vw - 250px);
          height: 100vh;
          z-index: -1;
      }
    </style>
  </head>

  <body>

    <!-- Fenêtre de partage d'agenda -->
<div id="share-dialog" style="
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    display: none;
    z-index: 9999;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
">
    <h3>Partager un agenda</h3>

    <label>Agenda :</label><br>
    <select id="share-agenda-select"></select><br><br>

    <label>Utilisateur :</label><br>
    <select id="share-user-select"></select><br><br>

    <button id="share-confirm">Partager</button>
    <button onclick="document.getElementById('share-dialog').style.display='none'">
        Annuler
    </button>
</div>


    <!-- Colonne des agendas -->
    <div id="sidebar">
        <div class="agenda-header">
            <h2>Mes agendas</h2>
            <button id="new-agenda">+</button>
        </div>
        <ul id="agenda-list"></ul>
    </div>

    <!-- Canvas Pixi -->
    <canvas id="canvasBackground"></canvas>

    <div id="dialog-container"></div>
    <script type="module" src="/src/main.js"></script>

    <script>

    
     document.body.addEventListener('htmx:afterSwap', function (event) {
         const dialog = event.detail.elt.querySelector('dialog');
         if (dialog) {
             dialog.showModal();
         }
     });

     document.body.addEventListener("eventSaved", (evt) => {
         const serverData = evt.detail;
         const formattedEvent = {
             ...serverData,
             startDate: new Date(serverData.startDate),
             endDate: new Date(serverData.endDate),
             color: parseInt(serverData.color, 16),
         };

         const appEvent = new CustomEvent('dispatchApp', {
             detail: { type: 'SAVE_EVENT', event: formattedEvent }
         });
         document.body.dispatchEvent(appEvent);
     });

     document.body.addEventListener("eventDeleted", (evt) => {
         const serverData = evt.detail;
         const appEvent = new CustomEvent('dispatchApp', {
             detail: { type: 'EVENT_DELETED', event: serverData.value }
         });
         document.body.dispatchEvent(appEvent);
     });
    </script>

  </body>
</html>
